\hypertarget{query_8c-example}{}\section{query.\+c}
An example that shows how to use rpc\+\_\+query A\+PI.


\begin{DoxyCodeInclude}
\textcolor{comment}{/*}
\textcolor{comment}{ * Copyright 2017 Two Pore Guys, Inc.}
\textcolor{comment}{ * All rights reserved}
\textcolor{comment}{ *}
\textcolor{comment}{ * Redistribution and use in source and binary forms, with or without}
\textcolor{comment}{ * modification, are permitted providing that the following conditions}
\textcolor{comment}{ * are met:}
\textcolor{comment}{ * 1. Redistributions of source code must retain the above copyright}
\textcolor{comment}{ *    notice, this list of conditions and the following disclaimer.}
\textcolor{comment}{ * 2. Redistributions in binary form must reproduce the above copyright}
\textcolor{comment}{ *    notice, this list of conditions and the following disclaimer in the}
\textcolor{comment}{ *    documentation and/or other materials provided with the distribution.}
\textcolor{comment}{ *}
\textcolor{comment}{ * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR}
\textcolor{comment}{ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED}
\textcolor{comment}{ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE}
\textcolor{comment}{ * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY}
\textcolor{comment}{ * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL}
\textcolor{comment}{ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS}
\textcolor{comment}{ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)}
\textcolor{comment}{ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,}
\textcolor{comment}{ * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING}
\textcolor{comment}{ * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE}
\textcolor{comment}{ * POSSIBILITY OF SUCH DAMAGE.}
\textcolor{comment}{ *}
\textcolor{comment}{ */}

\textcolor{preprocessor}{#include <stdio.h>}
\textcolor{preprocessor}{#include <\hyperlink{query_8h}{rpc/query.h}>}
\textcolor{preprocessor}{#include <\hyperlink{object_8h}{rpc/object.h}>}

\textcolor{keywordtype}{int}
main(\textcolor{keywordtype}{int} argc, \textcolor{keyword}{const} \textcolor{keywordtype}{char} *argv[])
\{
    \hyperlink{object_8h_ab365f726b4975c0c8376b808d111d01b}{rpc\_object\_t} start\_object;
    \hyperlink{object_8h_ab365f726b4975c0c8376b808d111d01b}{rpc\_object\_t} retval;
    \hyperlink{query_8h_a927ba6540a1cd3a2f2cf5d20b39fdadd}{rpc\_query\_iter\_t} iter;
    \textcolor{keyword}{struct }\hyperlink{structrpc__query__params}{rpc\_query\_params} params = \{.offset = 1, .reverse = \textcolor{keyword}{true}\};
    \hyperlink{object_8h_ab365f726b4975c0c8376b808d111d01b}{rpc\_object\_t} chunk;

    (void)argc;
    (void)argv;

    start\_object = \hyperlink{object_8h_a8a8454f12dcde323f5daba961febea97}{rpc\_object\_pack}(\textcolor{stringliteral}{"\{s,i,u,b,n,[i,i,i,\{s\}]\}"},
        \textcolor{stringliteral}{"hello"}, \textcolor{stringliteral}{"world"},
        \textcolor{stringliteral}{"int"}, -12345L,
        \textcolor{stringliteral}{"uint"}, 0x80808080L,
        \textcolor{stringliteral}{"true\_or\_false"}, \textcolor{keyword}{true},
        \textcolor{stringliteral}{"nothing"},
        \textcolor{stringliteral}{"array"},
        1L, 2L, 3L, \textcolor{stringliteral}{"!"}, \textcolor{stringliteral}{"?"});

    printf(\textcolor{stringliteral}{"start dictionary: %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(start\_object));

    printf(\textcolor{stringliteral}{"adding nonexistent containers with set function\(\backslash\)n"});
    \hyperlink{query_8h_a03159f0ef216c368c85ea63dd5a6cd64}{rpc\_query\_set}(start\_object, \textcolor{stringliteral}{"a.0.bunch.1.of.2.nonexistent.3.values"}, 
      \hyperlink{object_8h_af1b839aeabfc9be778224c3d191cafdc}{rpc\_bool\_create}(\textcolor{keyword}{true}), \textcolor{keyword}{true});
    retval = \hyperlink{query_8h_a6b66ceac8404c2581558e4fa3dfc048e}{rpc\_query\_get}(start\_object, \textcolor{stringliteral}{"a"}, NULL);
    printf(\textcolor{stringliteral}{"generated tree: %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(retval));
    \hyperlink{query_8h_af59ef4e3522115f09116bf7048738de4}{rpc\_query\_delete}(start\_object, \textcolor{stringliteral}{"a"});

    retval = \hyperlink{query_8h_a6b66ceac8404c2581558e4fa3dfc048e}{rpc\_query\_get}(start\_object, \textcolor{stringliteral}{"array.0"}, NULL);
    printf(\textcolor{stringliteral}{"array.0 (1): %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(retval));

    retval = \hyperlink{query_8h_a6b66ceac8404c2581558e4fa3dfc048e}{rpc\_query\_get}(start\_object, \textcolor{stringliteral}{"array.10"}, 
      \hyperlink{object_8h_a8c515bb8b1add8dbe86e615f048182a2}{rpc\_int64\_create}(19));
    printf(\textcolor{stringliteral}{"array.10 (nonexistent, default: 19): %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(retval))
      ;

    printf(\textcolor{stringliteral}{"%s"}, \textcolor{stringliteral}{"Set array.0 = true\(\backslash\)n"});
    \hyperlink{query_8h_a03159f0ef216c368c85ea63dd5a6cd64}{rpc\_query\_set}(start\_object, \textcolor{stringliteral}{"array.0"}, \hyperlink{object_8h_af1b839aeabfc9be778224c3d191cafdc}{rpc\_bool\_create}(\textcolor{keyword}{true}), \textcolor{keyword}{false});
    retval = \hyperlink{query_8h_a6b66ceac8404c2581558e4fa3dfc048e}{rpc\_query\_get}(start\_object, \textcolor{stringliteral}{"array.0"}, NULL);
    printf(\textcolor{stringliteral}{"array.0 (true): %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(retval));

    printf(\textcolor{stringliteral}{"%s"}, \textcolor{stringliteral}{"Delete array.0 (array shifts)\(\backslash\)n"});
    \hyperlink{query_8h_af59ef4e3522115f09116bf7048738de4}{rpc\_query\_delete}(start\_object, \textcolor{stringliteral}{"array.0"});
    retval = \hyperlink{query_8h_a6b66ceac8404c2581558e4fa3dfc048e}{rpc\_query\_get}(start\_object, \textcolor{stringliteral}{"array.0"}, NULL);
    printf(\textcolor{stringliteral}{"array.0 (2): %s\(\backslash\)n\(\backslash\)n"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(retval));

    printf(\textcolor{stringliteral}{"Contains?: array.0 (true): %s\(\backslash\)n\(\backslash\)n"},
        \hyperlink{query_8h_a530296c952ff239de8b91371227d36ba}{rpc\_query\_contains}(start\_object, \textcolor{stringliteral}{"array.0"}) ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
    printf(\textcolor{stringliteral}{"Contains?: array.10 (false): %s\(\backslash\)n\(\backslash\)n"},
        \hyperlink{query_8h_a530296c952ff239de8b91371227d36ba}{rpc\_query\_contains}(start\_object, \textcolor{stringliteral}{"array.10"}) ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
    printf(\textcolor{stringliteral}{"Contains?: test (false): %s\(\backslash\)n\(\backslash\)n"},
        \hyperlink{query_8h_a530296c952ff239de8b91371227d36ba}{rpc\_query\_contains}(start\_object, \textcolor{stringliteral}{"test"}) ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});

    \hyperlink{object_8h_aac19be935f72b35eeb2851bc509eabb2}{rpc\_release}(start\_object);

    start\_object = \hyperlink{object_8h_a8a8454f12dcde323f5daba961febea97}{rpc\_object\_pack}(\textcolor{stringliteral}{"[\{u\},\{u\},\{u\},\{u\},\{u\}]"},
        \textcolor{stringliteral}{"value"}, 1,
        \textcolor{stringliteral}{"value"}, 2,
        \textcolor{stringliteral}{"value"}, 3,
        \textcolor{stringliteral}{"value"}, 4,
        \textcolor{stringliteral}{"value"}, 5);

    printf(\textcolor{stringliteral}{"Initial object for query (reverse, offset =1, o > 2): %s\(\backslash\)n\(\backslash\)n"},
        \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(start\_object));

    iter = \hyperlink{query_8h_a674e1f4b009fc26f19dd33d0c5d0b10d}{rpc\_query\_fmt}(start\_object, &params, \textcolor{stringliteral}{"[[ssu]]"},
        \textcolor{stringliteral}{"value"}, \textcolor{stringliteral}{">"}, 2);

    \textcolor{keywordflow}{while} (\hyperlink{query_8h_a979b1dfd5f0fb3be66501ed3c7df3f78}{rpc\_query\_next}(iter, &chunk)) \{
        printf(\textcolor{stringliteral}{"%s"}, \hyperlink{object_8h_ac3266a5b20add52514c1b2c70a4a5878}{rpc\_copy\_description}(chunk));
        \hyperlink{object_8h_aac19be935f72b35eeb2851bc509eabb2}{rpc\_release}(chunk);
    \}

    \hyperlink{query_8h_acfa3a9a25b98a0acd3a64c7c222e5f99}{rpc\_query\_iter\_free}(iter);
    \hyperlink{object_8h_aac19be935f72b35eeb2851bc509eabb2}{rpc\_release}(start\_object);
\}
\end{DoxyCodeInclude}
 